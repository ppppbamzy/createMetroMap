%!TEX program = xelatex

\documentclass[border=1cm]{standalone}

\usepackage{xeCJK}

\usepackage{tikz}
\usetikzlibrary{shapes,positioning,fit}

\setmainfont{Roboto Slab Bold}
\setmonofont{Roboto Mono Bold}
\setCJKmainfont{苹方-简 中粗体}

\begin{document}
\begin{tikzpicture}[every node/.append style={rounded corners, inner sep=2}]
            
    \tikzset{pillbox/.style={text width = 2.1ex, anchor = center, draw, very thick, fill=white, align = center, execute at begin node=\setlength{\baselineskip}{2ex}}};
    \tikzset{shupai/.style={align = center, execute at begin node=\setlength{\baselineskip}{2ex}}};
    \tikzset{tube/.style={line width=6pt}};
    \tikzset{color1/.style={brown}};
    \tikzset{box1/.style={draw=brown}};
    \tikzset{box2/.style={draw=purple}};
    \tikzset{color2/.style={purple}};
    \tikzset{testlayout/.style={circle, draw}};
    \tikzset{inter/.style={rectangle, sharp corners, draw, very thick, fill=gray}};

    % line 1
    \coordinate (l1s6);
    \foreach \dis/\num in {1/7, 2/8, 3/9}
        \coordinate[right = 2 * \dis of l1s6] (l1s\num);
    \foreach \dis/\num in {1/5, 2/4, 3/3}
        \coordinate[left = 2 * \dis of l1s6] (l1s\num);
    \coordinate[left = 7 of l1s6] (l1c1);
    \foreach \dis/\num in {0.5/2, 1.5/1}
        \coordinate[below left = {1.414 * \dis} of l1c1] (l1s\num);
%    \foreach \num in {1, 2, 3, 4, 5, 6, 7, 8, 9}
%        \node[testlayout] at (l1s\num) {};
    \foreach \num in {1, 2, 3, 5, 6, 7, 8, 9}
        \node[pillbox, box1] (l1s\num_num) at (l1s\num) {G\tt\\0\num};
    \node[pillbox, box1, left = 0 of l1s4] (l1s4_num) {G\tt\\04};
    \foreach \l/\n in {1/2, 3/4, 4/5, 5/6, 6/7, 7/8, 8/9}
        \draw[tube, color1] (l1s\l) -- (l1s\n);
    \draw[tube, color1, rounded corners] (l1s2) -- (l1c1) -- (l1s3);
    % 覆盖一遍
    \foreach \num in {1, 2, 3, 5, 6, 7, 8, 9}
        \node[pillbox, box1] (l1s\num_num) at (l1s\num) {G\tt\\0\num};
    \node[pillbox, box1, left = 0 of l1s4] (l1s4_num) {G\tt\\04};
    \foreach \num in {3, 5, 6, 7, 8, 9}
        \node[above = 0 of l1s\num_num] (l1s\num_name) {我家};
    \foreach \num in {1, 2}
        \node[shupai, above = 0 of l1s\num_num] (l1s\num_name) {我\\家};
    \node[above = 0 of l1s4_num, xshift = -0.5ex, yshift = 0.5ex] (l1s4_name) {\Large 我駅};
        
    % line 2    
    \coordinate (l2s4) at (l1s4);
    \node[pillbox, box2, right = 0 of l2s4] (l2s4_num) {H\tt\\04};
    \coordinate (l2s4) at (l2s4_num);
    \node[inter, fit = (l1s4_num) (l2s4_num)] {};
    \foreach \dis/\num in {1/3, 2/2, 3/1}
        \coordinate[above = 2 * \dis of l2s4] (l2s\num);
    \foreach \dis/\num in {1/5, 2/6}
        \coordinate[below = 2 * \dis of l2s4] (l2s\num);
    \coordinate[below right = 3 of l2s6] (l2s7);
    \foreach \dis/\num in {1/8, 2/9, 3/10}
        \coordinate[right = 2 * \dis of l2s7] (l2s\num);
%    \foreach \num in {1, 2, 3, 4, 5, 6, 7, 8, 9, 10}
%        \node[testlayout] at (l2s\num) {};
    \foreach \num in {1, 2, 3, 5, 6, 7, 8, 9}
        \node[pillbox, box2] (l2s\num_num) at (l2s\num) {H\tt\\0\num};
    \node[pillbox, box2] (l2s10_num) at (l2s10) {H\tt\\10};
    \foreach \l/\n in {1/2, 2/3, 3/4, 4/5, 5/6, 7/8, 8/9, 9/10}
        \draw[tube, color2] (l2s\l) -- (l2s\n);
    \draw[tube, color2, rounded corners] (l2s6) |- (l2s7);
    % 覆盖一遍
    \node[inter, fit = (l1s4_num) (l2s4_num)] {};
    \foreach \num in {1, 2, 3, 4, 5, 6, 7, 8, 9}
        \node[pillbox, box2] (l2s\num_num) at (l2s\num) {H\tt\\0\num};
    \node[pillbox, box2] (l2s10) at (l2s10) {H\tt\\10};
    \node[pillbox, box1, left = 0 of l1s4] (l1s4_num) {G\tt\\04};
    \foreach \num in {1, 2, 3, 5, 6}
        \node[right = 0 of l2s\num_num] (l2s\num_name) {我家};
    \foreach \num in {7, 8, 9, 10}
        \node[below = 0 of l2s\num_num] (l2s\num_name) {我家};
\end{tikzpicture}
\end{document}
